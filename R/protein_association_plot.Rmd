---
title: "Plot protein association with enriched terms using cnetplot"
output: results/enrichment_analysis/For_R
---


```{r}

# help functions and variables
library(clusterProfiler)
library(DOSE)
library(enrichplot)
library(readr)
library(jamba)
library(multienrichjam)
library(ggplot2)
library(rjson)
MAIN_DIR <- "C:/Users/nourisa/Documents/testProjs/proteomics_MSC_Mg_model"
TO_SAVE <- paste(MAIN_DIR, 'results/enrichment_analysis/For_R', sep='/')

reireive_EA_data_F <- function (file_name){ "Reads enrich data"
  file <- paste(MAIN_DIR,'results/enrichment_analysis/For_R',file_name,sep="/")
  data <- read.csv(file)
  data$X <- NULL
  return(data)
}

dataFrame2enrich_F <- function(df){"converts dataframe to enriched object"
  enrich_df = enrichDF2enrichResult(
    enrichDF = df,
    pvalueCutoff = 1,
    pAdjustMethod = "none",
    keyColname = c("category"),
    pathGenes = "pathGenes",
    geneColname = c("ProteinNames"),
    geneHits = "geneHits",
    geneRatioColname = c("ProteinRatio", "Ratio"),
    geneDelim = "[,/ ]+",
    pvalueColname = c("P.Value", "Pvalue", "FDR", "adj.P.Val"),
    descriptionColname = c("Description", "Name", "Pathway", "ID"))
  return (enrich_df)
}
cnet_plot_F <- function(df_s, circular){
  p <- cnetplot(df_s, layout = "kk", circular = circular, colorEdge = TRUE,
                cex_label_category=.8,cex_label_gene=.7, cex_category=.5, cex_gene=1, node_label="category") 
  
  return(p)
}
dot_plot_F <- function(obj, font_size, label_format, title,showCategory){
  dotplot(
    obj, 
    x = "GeneRatio",
    color = "p.adjust",
    size = "Strength",
    showCategory = showCategory,
    label_format = label_format,
    orderBy = 'Strength',
    font.size = font_size,
    title = title
  )
}
#- read differntially expressed proteins
DE_protnames_FILE <- paste(MAIN_DIR,'results/data/DE_protnames_json.json', sep='/')
DE_protnames <- fromJSON(file=DE_protnames_FILE)
DE_protnames_F <- function(model){"read DE proteins"
  return (DE_protnames[[model]])
}
# protein association plot
for (DE_type in list('day1_11_KNN','day1_21_KNN')){
  for (term in list('process','function','component')){
    file_name = sprintf('enrichment_%s_%s.csv', DE_type, term)
    enrich_data = reireive_EA_data_F(file_name)
    enrich_obj = dataFrame2enrich_F(enrich_data)
    
    
    
    base_height = 6
    base_asp = 1.1
    circular = TRUE
    if (DE_type == 'day1_21_KNN' & term == 'function'){
      base_height = 8
    }
    if (DE_type == 'day1_21_KNN' & term == 'process'){
      base_height = 6
    }
    if (DE_type == 'day1_21_KNN' & term == 'component'){
      base_height = 5
      circular = FALSE
    }
    
    p <- cnet_plot_F(enrich_obj, circular)
    
    cowplot::save_plot(sprintf('%s/dot_%s_%s.png',TO_SAVE, DE_type, term), p, ncol = 1, base_asp = base_asp, bg='White',base_height=base_height)
  }
} 
```


