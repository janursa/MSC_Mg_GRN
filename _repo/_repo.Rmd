```{r}
library(readr)
library(rjson)
library(igraph)
MAIN_DIR <- "C:/Users/nourisa/Documents/testProjs/proteomics_MSC_Mg_model"
#-- define custom shapes 
#- diamond
# MyDiamond <- function(coords, v=NULL, params) {
#   vertex.color <- params("vertex", "color")
#   if (length(vertex.color) != 1 && !is.null(v)) {
#     vertex.color <- vertex.color[v]
#   }
#   vertex.frame.color <- params("vertex", "frame.color")
#   if (length(vertex.frame.color) != 1 && !is.null(v)) {
#     vertex.frame.color <- vertex.frame.color[v]
#   }
#   vertex.size <- 1/200 * params("vertex", "size")
#   if (length(vertex.size) != 1 && !is.null(v)) {
#     vertex.size <- vertex.size[v]
#   }
#   
#   symbols(x=coords[,1], y=coords[,2], bg=vertex.color, fg=vertex.frame.color,
#           stars=cbind(vertex.size, vertex.size, vertex.size, vertex.size),
#           add=TRUE, inches=FALSE)
# }
# add_shape("diamond", clip=shapes("circle")$clip,
#           plot=MyDiamond, parameters=list(vertex.frame.color="white",
#                                            vertex.frame.width=1))
#- triangle
# add.vertex.shape(
# "triangle", clip = shapes("circle")$clip,
# plot = FELLA:::mytriangle)

#-- import data
read_nodes <- function(study){
  nodes_file <- paste(MAIN_DIR,'results/GRN/visualize',paste('nodes_',study,'.csv', sep=''),sep="/")
  nodes <- read.csv(nodes_file)
  return (nodes)
}
read_edges <- function(study){
  edges_file <- paste(MAIN_DIR,'results/GRN/visualize',paste('edges_',study,'.csv', sep=''),sep="/")
  edges <- read.csv(edges_file)
  return (edges)
}

nodes_ctr <- read_nodes('ctr')
edges_ctr <- read_edges('ctr')
# nodes_mg <- read_nodes('mg')
# edges_mg <- read_edges('mg')
#- make some changes
#nodes_ctr$Role = nodes_ctr$Role+1
#nodes_mg$Role = nodes_mg$Role+1
#- define settings
# shapes = c('circle','circle','circle','diamond') 
# palette(gray.colors(100)) # color range
#- actual plot
build_net_and_plot_network <- function(edges, nodes, i){
  #- build net and edit the data
  net <- graph_from_data_frame(d=edges, vertices=nodes)
  # E(net)$Width <- 1+E(net)$Weight/12
  # V(net)$FitScore <- ifelse(V(net)$FitScore < 0, 0, V(net)$FitScore)
  # V(net)$FitScore <- as.integer(10*V(net)$FitScore+10)
  #- filter edges
  cut_off <- quantile(E(net)$Weight)[4]
  
  net.sp <- delete_edges(net, E(net)[Weight<0])
  #- plot func
  # label_font = ifelse(i==0, 0.5, 1)
  plot(
    net.sp,
    edge.arrow.size=.4, 
    edge.curved=1, 
    directed=T, 
     # vertex.label = V(net)$Protein, 
     # vertex.shape = shapes[V(net)$Role], 
     # vertex.color = 1:100,
     # vertex.size = seq(1,48,1),
     # vertex.size = V(net)$FitScore,
     # edge.width = E(net)$Weight,
     # vertex.label.cex = label_font,
     # vertex.frame.color = 'black',
     # edge.arrow.size = .3,
     layout= layout_with_fr(net.sp)
     )
  
  #---- legend annotation for size
  # size_data <- nodes$FitScore
  # size_data <- ifelse(size_data<0, 0, size_data)
  # n <- 6
  # size_vec <- seq_len(n)
  # sizeCut<-cut(size_data,n)
  # legend_names <- seq(min(size_data),max(size_data),(max(size_data)-min(size_data))/(n-1))
  # legend_names <- as.integer(legend_names*100)
  # print(length(legend_names))
  # op <- par(cex = 0.5) # for size
  # a <- legend(x=-1.3, y=+.7,
  #             legend=legend_names,
  #             col='white',
  #             pch=21, 
  #             title='Fitness score')
  # x <- (a$text$x + a$rect$left) / 2
  # y <- a$text$y
  # symbols(x, y, circles=size_vec/150, inches=FALSE, add=TRUE, bg='orange')
  # 
  #- legend annotation for shape
  # if (i==0){
  #   legend(x=-1.3, y=-.7, legend=c("Buffering/Passive/Active", "Critical"), pch=c(21,23),
  #   col="white", pt.bg='orange', pt.cex=2, cex=.8, bty="n", ncol=1, title='Protein role')
  # }
  
}
#- visualize
pdf("GRN_1.pdf")
par(mfrow=c(1,1), mar=c(0,0,0,0)) # plot four figures - 2 rows, 2 columns
build_net_and_plot_network(edges_ctr, nodes_ctr, 0)
# build_net_and_plot_network(edges_mg, nodes_mg, 1)

dev.off()

```



